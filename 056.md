0xStalin

medium

# Bad debts could not be liquidated

## Summary
When admins would like to liquidate bad debts that are floating on the system because nobody liquidated them, if the liquidated trader has some collateral in its account, the liquidation won't be executed

## Vulnerability Detail
The internal _handleBadDebt() function needs the liquidated account to not have any collateral on its account in order to execute its logic, if the liquidated account has any amount of any valid collateral, the debt won't be liquidated and will still be active on the system.
```solidity
function _handleBadDebt(address liquidatedTrader) internal {
      DataTypes.UserInfo storage liquidatedTraderInfo = userInfo[
          liquidatedTrader
      ];
      uint256 tRate = getTRate();
      if (
          liquidatedTraderInfo.collateralList.length == 0 &&
          _isStartLiquidation(liquidatedTraderInfo, tRate)
      ) {
          DataTypes.UserInfo storage insuranceInfo = userInfo[insurance];
          uint256 borrowJUSDT0 = liquidatedTraderInfo.t0BorrowBalance;
          insuranceInfo.t0BorrowBalance += borrowJUSDT0;
          liquidatedTraderInfo.t0BorrowBalance = 0;
          emit HandleBadDebt(liquidatedTrader, borrowJUSDT0);
      }
}
```

## Impact
Bad debts that have any collateral left won't be able to be liquidated by the admins

## Code Snippet
https://github.com/sherlock-audit/2023-04-jojo/blob/main/JUSDV1/src/Impl/JUSDBank.sol#L496-L511

## Tool used
Manual Review

## Recommendation
- Split the two checks of the [if() statment](https://github.com/sherlock-audit/2023-04-jojo/blob/main/JUSDV1/src/Impl/JUSDBank.sol#L501-L504)
- The first path can be in the case the liquidated account has any amount of collateral left, and then execute the [exact logic that is coded right now](https://github.com/sherlock-audit/2023-04-jojo/blob/main/JUSDV1/src/Impl/JUSDBank.sol#L505-L509).
- The second path can be in the case the liquidated account [still has some collateral on its account](https://github.com/sherlock-audit/2023-04-jojo/blob/main/JUSDV1/src/Impl/JUSDBank.sol#L503), in this case, the system should take away all the left collateral from the liquidated account and credit it to the liquidation pools.
